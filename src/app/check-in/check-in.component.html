<div class="check-in-container">
  <h2>Check-in khuôn mặt</h2>

  <div class="mode-toggle">
    <button (click)="toggleMode('camera')" [class.active]="currentMode === 'camera'">Camera</button>
    <button (click)="toggleMode('file')" [class.active]="currentMode === 'file'">Upload File</button>
  </div>

  <div class="video-container" [style.display]="currentMode === 'camera' ? 'block' : 'none'">
    <video #videoElement autoplay playsinline></video>
    <canvas #canvasElement></canvas>
    @if (loading || loaddingModels) {
      <div class="loading-overlay">
        <div class="spinner"></div>
        <p>Đang xử lý...</p>
      </div>
    }
    <div class="face-detection-overlay" [class.face-valid]="faceValid" [class.face-invalid]="!faceValid && !loading && !loaddingModels" [class.face-detecting]="faceDetecting"></div>
  </div>

  <div class="file-upload-container" [style.display]="currentMode === 'file' ? 'flex' : 'none'"
       (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
       [class.drag-hover]="isDragging">
    <input type="file" (change)="onFileSelected($event)" accept="image/*" [attr.multiple]="false" #fileInput style="display: none;">
    <div class="file-upload-area" (click)="fileInput.click()">
      <canvas #fileCanvasElement></canvas>
      @if (!selectedFile && !loaddingModels) {
        <p class="placeholder-text">Kéo thả ảnh vào đây hoặc click để chọn</p>
      }
      @if (loading || loaddingModels) {
        <div class="loading-overlay">
          <div class="spinner"></div>
          <p>Đang xử lý...</p>
        </div>
      }
      <div class="face-detection-overlay" [class.face-valid]="faceValid" [class.face-invalid]="!faceValid && selectedFile && !loading && !loaddingModels" [class.face-detecting]="faceDetecting"></div>
    </div>
  </div>

  <button (click)="currentMode === 'camera' ? handleCheckIn() : handleFileCheckIn()" [disabled]="loading || !faceValid">
    {{ currentMode === 'camera' ? 'Check-in từ Camera' : 'Check-in từ File' }}
  </button>

@if (checkInResult) {
  <div class="result">
    {{ checkInResult }}
  </div>
}
</div>
